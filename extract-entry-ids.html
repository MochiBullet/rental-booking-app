<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Forms Entry ID æŠ½å‡º</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .instruction { background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .result { background: #f5f5f5; padding: 10px; border-radius: 5px; margin-top: 10px; font-family: monospace; white-space: pre-wrap; }
        button { padding: 10px 20px; background: #2196f3; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        input[type="text"] { width: 100%; padding: 8px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>ğŸ” Google Forms Entry ID æŠ½å‡ºãƒ„ãƒ¼ãƒ«</h1>
    
    <div class="instruction">
        <h3>ğŸ“‹ æ‰‹é †:</h3>
        <ol>
            <li>Google Forms (<a href="https://docs.google.com/forms/d/e/1FAIpQLSdM1hGazWWkJJFFbMJBAzl-lEXE20XMtwfO_h-o7hEol8-bpw/viewform" target="_blank">ãƒªãƒ³ã‚¯</a>) ã‚’åˆ¥ã‚¿ãƒ–ã§é–‹ã</li>
            <li>ãƒ•ã‚©ãƒ¼ãƒ ä¸Šã§å³ã‚¯ãƒªãƒƒã‚¯ â†’ ã€Œãƒšãƒ¼ã‚¸ã®ã‚½ãƒ¼ã‚¹ã‚’è¡¨ç¤ºã€</li>
            <li>HTMLã‚½ãƒ¼ã‚¹å…¨ä½“ã‚’ã‚³ãƒ”ãƒ¼</li>
            <li>ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã«è²¼ã‚Šä»˜ã‘</li>
            <li>ã€ŒEntry ID ã‚’æŠ½å‡ºã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
        </ol>
    </div>

    <textarea id="htmlSource" placeholder="ã“ã“ã«Google Formsã®HTMLã‚½ãƒ¼ã‚¹ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„..." style="width: 100%; height: 200px; font-family: monospace; font-size: 12px;"></textarea>
    
    <button onclick="extractEntryIds()">ğŸ” Entry ID ã‚’æŠ½å‡º</button>
    <button onclick="testWithBlankForm()">ğŸ“ ç©ºã®ãƒ•ã‚©ãƒ¼ãƒ ã§è©¦ã™</button>
    
    <div id="result" class="result"></div>

    <script>
        function extractEntryIds() {
            const htmlSource = document.getElementById('htmlSource').value;
            const resultDiv = document.getElementById('result');
            
            if (!htmlSource.trim()) {
                resultDiv.innerHTML = 'âŒ HTMLã‚½ãƒ¼ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
                return;
            }
            
            console.log('HTML Source Length:', htmlSource.length);
            
            // entry. ã§å§‹ã¾ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŠ½å‡º
            const entryPattern = /entry\.(\d+)/g;
            const entries = [];
            let match;
            
            while ((match = entryPattern.exec(htmlSource)) !== null) {
                const entryId = match[1];
                if (!entries.includes(entryId)) {
                    entries.push(entryId);
                }
            }
            
            // nameå±æ€§ã®entry IDã‚’æŠ½å‡º
            const namePattern = /name=["']entry\.(\d+)["']/g;
            while ((match = namePattern.exec(htmlSource)) !== null) {
                const entryId = match[1];
                if (!entries.includes(entryId)) {
                    entries.push(entryId);
                }
            }
            
            // data-paramså†…ã®entry IDã‚’æŠ½å‡º
            const dataParamsPattern = /data-params=".*?entry\.(\d+).*?"/g;
            while ((match = dataParamsPattern.exec(htmlSource)) !== null) {
                const entryId = match[1];
                if (!entries.includes(entryId)) {
                    entries.push(entryId);
                }
            }
            
            // FB_PUBLIC_LOAD_DATAå†…ã®entry IDã‚’æŠ½å‡º
            const fbDataPattern = /FB_PUBLIC_LOAD_DATA.*?"entry\.(\d+)"/g;
            while ((match = fbDataPattern.exec(htmlSource)) !== null) {
                const entryId = match[1];
                if (!entries.includes(entryId)) {
                    entries.push(entryId);
                }
            }
            
            entries.sort();
            
            let result = `è¦‹ã¤ã‹ã£ãŸEntry IDs (${entries.length}å€‹):\n\n`;
            
            entries.forEach((entryId, index) => {
                result += `entry.${entryId}\n`;
            });
            
            result += '\n\nğŸ“ ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ç”¨ã‚³ãƒ¼ãƒ‰:\n';
            result += 'const formData = new FormData();\n';
            entries.forEach((entryId, index) => {
                result += `formData.append('entry.${entryId}', 'ãƒ†ã‚¹ãƒˆå€¤${index + 1}'); // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰${index + 1}\n`;
            });
            
            result += '\n\nğŸ§ª ãƒ†ã‚¹ãƒˆé€ä¿¡ç”¨URL:\n';
            const testUrl = 'https://docs.google.com/forms/d/e/1FAIpQLSdM1hGazWWkJJFFbMJBAzl-lEXE20XMtwfO_h-o7hEol8-bpw/viewform?usp=pp_url';
            entries.forEach((entryId, index) => {
                result += `&entry.${entryId}=TEST${index + 1}`;
            });
            
            resultDiv.innerHTML = result;
        }
        
        function testWithBlankForm() {
            // æ–°ã—ã„ãƒ–ãƒ©ã‚¦ã‚¶ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ç©ºã®ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‹ã
            const formUrl = 'https://docs.google.com/forms/d/e/1FAIpQLSdM1hGazWWkJJFFbMJBAzl-lEXE20XMtwfO_h-o7hEol8-bpw/formResponse';
            
            console.log('ç©ºã®ãƒ•ã‚©ãƒ¼ãƒ ã§ãƒ†ã‚¹ãƒˆé€ä¿¡ä¸­...');
            
            // ç©ºã®FormDataã§é€ä¿¡
            const formData = new FormData();
            
            fetch(formUrl, {
                method: 'POST',
                mode: 'no-cors',
                body: formData
            }).then(() => {
                console.log('ç©ºãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å®Œäº†');
                document.getElementById('result').innerHTML = 'âœ… ç©ºã®ãƒ•ã‚©ãƒ¼ãƒ ãƒ†ã‚¹ãƒˆé€ä¿¡å®Œäº†\n\nã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’ç¢ºèªã—ã¦ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã®ã¿ã®è¡ŒãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚';
            }).catch(err => {
                console.error('é€ä¿¡ã‚¨ãƒ©ãƒ¼:', err);
            });
        }
    </script>
</body>
</html>